---
title: "Final Project"
output: html_document
date: "2023-11-30"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(ggplot2)
library(gplots)
library(maps) 
library(dplyr)  
library(ggmap)
library(lubridate)
library(ggthemes)
library(RColorBrewer) 
library(sf)

```

```{r}

load('LAPOP.rda')
LAPOP <- da36562.0001
rm(da36562.0001)

```

```{r}
SouthAmerica <- LAPOP %>% 
  filter(PAIS %in% c("(17) Argentina", "(10) Bolivia", "(08) Colombia", "(15) Brazil", "(12) Paraguay", "(14) Uruguay", "(11) Peru", "(13) Chile", "(09) Ecuador", "(16) Venezuela", "(27) Suriname")) %>% 
  mutate(PAIS = substr(PAIS, 6, 20))

```

```{r}
# HUMAN RIGHTS (To what extent do you think that citizens' basic rights are well protected by the political system of country?) (1= not at all, 7= a lot)

SouthAmericaB3 <- SouthAmerica %>% 
  select(YEAR, PAIS, B3) %>% 
  drop_na() %>% 
  group_by(PAIS) %>% 
  summarise(averageB3 = mean(B3))

SouthAmericasf <- read_sf("vc965bq8111") %>%
  group_by(name) %>%
  summarise(geometry = st_combine(geometry)) %>%
  mutate(name = stringr::str_to_lower(name))
  

(SouthAmericasf %>% left_join(SouthAmericaB3 %>% mutate(PAIS = stringr::str_to_lower(PAIS)),by = c('name' = 'PAIS')) %>% 
  ggplot() +
  geom_sf(aes(fill = averageB3)) +
  labs(title = "Perception of Human Rights in South America", subtitle = "From a scale of 1 ('Not at all') to 7 ('A lot')", fill = "Average Perception of HR") +
  theme_map() +
  theme(legend.background = element_blank()) +
  theme(legend.position = "right")
 ) %>% plotly::ggplotly()

SouthAmericaB3 %>% 
  arrange(desc(averageB3))

```
```{r}
# LIFE SATISFACTION (In general how satisfied are you with your life?) (1 = very satisfied, 4 = very dissatisfied)

SouthAmericaLS3 <- SouthAmerica %>% 
  select(YEAR, PAIS, LS3) %>% 
  drop_na() %>% 
  group_by(PAIS) %>%  
  mutate(LS3num = fct_recode(LS3, "1" = "(1) Very Satisfied", "2" = "(2) Somewhat Satisfied", "3" = "(3) Somewhat Dissatisfied", "4" = "(4) Very Dissatisfied")) %>% 
  mutate(LS3num = as.numeric(LS3num)) %>% 
  summarise(averageLS3 = mean(LS3num))

SouthAmericasf <- read_sf("vc965bq8111") %>%
  group_by(name) %>%
  summarise(geometry = st_combine(geometry)) %>%
  mutate(name = stringr::str_to_lower(name))
  

SouthAmericasf %>% left_join(SouthAmericaLS3 %>% mutate(PAIS = stringr::str_to_lower(PAIS)),by = c('name' = 'PAIS')) %>% 
  ggplot() +
  geom_sf(aes(fill = averageLS3))

SouthAmericaLS3 %>% 
  arrange(averageLS3)
```

```{r}
# DEMOCRACY (Percent of people choosing "Democracy is preferable to any other form of government" and not "authoritarian " "it doesn't matter") 

SouthAmericaDEM2 <- SouthAmerica %>% 
  select(YEAR, PAIS, DEM2) %>% 
  drop_na() %>% 
  group_by(PAIS) %>% 
  mutate(total_resp_country = n()) %>% 
  filter(DEM2 == "(2) Democracy is preferable to any other form of government") %>% 
  mutate(total_dem2_country = n()) %>% 
  distinct(PAIS, .keep_all = TRUE) %>% 
  mutate(percent_DEM2 = total_dem2_country / total_resp_country)


SouthAmericasf <- read_sf("vc965bq8111") %>%
  group_by(name) %>%
  summarise(geometry = st_combine(geometry)) %>%
  mutate(name = stringr::str_to_lower(name))
  

SouthAmericasf %>% left_join(SouthAmericaDEM2 %>% mutate(PAIS = stringr::str_to_lower(PAIS)),by = c('name' = 'PAIS')) %>% 
  ggplot() +
  geom_sf(aes(fill = percent_DEM2))

SouthAmericaDEM2 %>% 
  select(PAIS, percent_DEM2) %>% 
  arrange(desc(percent_DEM2))
```

```{r}
# ECONOMIC SITUATION SOCT1 (How would you describe the country's economic situation?) (Percent of people that chose  "Good" or "Very Good" and not "fair, "bad" "very bad")


#shows NA values for this question (per country)
SouthAmerica %>% 
  select(YEAR, PAIS, SOCT1) %>% 
  group_by(PAIS) %>% 
  mutate(total_resp_country = n()) %>%
  mutate(num_na = sum(is.na(SOCT1))) %>% 
  distinct(PAIS, .keep_all = TRUE)



SouthAmericaSOCT1 <- SouthAmerica %>% 
  select(YEAR, PAIS, SOCT1) %>% 
  drop_na() %>% 
  group_by(PAIS) %>% 
  mutate(total_resp_country = n()) %>% 
  filter(SOCT1 %in% c("(2) Good", "(1) Very Good")) %>% 
  mutate(total_good_country = n()) %>% 
  distinct(PAIS, .keep_all = TRUE) %>% 
  mutate(percent_good = total_good_country / total_resp_country)


SouthAmericasf <- read_sf("vc965bq8111") %>%
  group_by(name) %>%
  summarise(geometry = st_combine(geometry)) %>%
  mutate(name = stringr::str_to_lower(name))
  

SouthAmericasf %>% left_join(SouthAmericaSOCT1 %>% mutate(PAIS = stringr::str_to_lower(PAIS)),by = c('name' = 'PAIS')) %>% 
  ggplot() +
  geom_sf(aes(fill = percent_good))

SouthAmericaSOCT1 %>% 
  select(PAIS, percent_good) %>% 
  arrange(desc(percent_good))
```

