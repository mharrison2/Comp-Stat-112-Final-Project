---
title: "Final Project"
output: html_document
date: "2023-11-30"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(ggplot2)
library(gplots)
library(maps) 
library(dplyr)  
library(ggmap)
library(lubridate)
library(ggthemes)
library(RColorBrewer) 
library(sf)

```

```{r}

load('LAPOP.rda')
LAPOP <- da36562.0001
rm(da36562.0001)

```

```{r}
SouthAmerica <- LAPOP %>% 
  filter(PAIS %in% c("(17) Argentina", "(10) Bolivia", "(08) Colombia", "(15) Brazil", "(12) Paraguay", "(14) Uruguay", "(11) Peru", "(13) Chile", "(09) Ecuador", "(16) Venezuela", "(27) Suriname")) %>% 
  mutate(PAIS = substr(PAIS, 6, 20))

```

```{r}
# HUMAN RIGHTS (To what extent do you think that citizens' basic rights are well protected by the political system of country?) (1= not at all, 7= a lot)

SouthAmericaB3 <- SouthAmerica %>% 
  select(YEAR, PAIS, B3) %>% 
  drop_na() %>% 
  group_by(PAIS) %>%
  mutate(total_resp_b3 = n()) %>% 
  filter( B3 >= 5) %>% 
  mutate(total_positive_b3 = n()) %>% 
  distinct(PAIS, .keep_all = TRUE) %>% 
  mutate(percent_good_b3 = 100 * total_positive_b3 / total_resp_b3) 

SouthAmericasf <- read_sf("vc965bq8111") %>%
  group_by(name) %>%
  summarise(geometry = st_combine(geometry)) %>%
  mutate(name = stringr::str_to_lower(name))
  

(SouthAmericasf %>% left_join(SouthAmericaB3 %>% mutate(PAIS = stringr::str_to_lower(PAIS)),by = c('name' = 'PAIS')) %>% 
  ggplot() +
  geom_sf(aes(fill = percent_good_b3)) +
  theme_map() +
  theme(legend.background = element_blank()) +
  theme(legend.position = "right")
 ) %>% plotly::ggplotly()

SouthAmericaB3 %>% 
  arrange(desc(percent_good_b3))

#  labs(title = "How Many South Americans   ", subtitle = "Respondents were asked: To what extent do you think that citizens' basic rights are well protected by the political system of country?", fill = "percent of respondants who answered that the political system highly protects their basic rights. % of Respondents with a Positive View of Basic Rights' Protection") 
```

```{r}
# LIFE SATISFACTION (In general how satisfied are you with your life?) (1 = very satisfied, 4 = very dissatisfied)

SouthAmericaLS3 <- SouthAmerica %>% 
  select(YEAR, PAIS, LS3) %>% 
  drop_na() %>% 
  group_by(PAIS) %>%
  mutate(LS3num = fct_recode(LS3, "1" = "(1) Very Satisfied", "2" = "(2) Somewhat Satisfied", "3" = "(3) Somewhat Dissatisfied", "4" = "(4) Very Dissatisfied")) %>%
  mutate(total_resp_country = n()) %>% 
  filter(LS3num == "1") %>% 
  mutate(total_positive_resp = n()) %>% 
  distinct(PAIS, .keep_all = TRUE) %>% 
  mutate(percent_good_ls3 = 100 * total_positive_resp / total_resp_country) 

SouthAmericasf <- read_sf("vc965bq8111") %>%
  group_by(name) %>%
  summarise(geometry = st_combine(geometry)) %>%
  mutate(name = stringr::str_to_lower(name))
  

(SouthAmericasf %>% left_join(SouthAmericaLS3 %>% mutate(PAIS = stringr::str_to_lower(PAIS)),by = c('name' = 'PAIS')) %>% 
  ggplot() +
  theme_map() +
  theme(legend.background = element_blank()) +
  theme(legend.position = "right") +
  geom_sf(aes(fill = percent_good_ls3))) %>% plotly::ggplotly()

SouthAmericaLS3 %>% 
  arrange(percent_good_ls3)
```

```{r}
# DEMOCRACY (Percent of people choosing "Democracy is preferable to any other form of government" and not "authoritarian " "it doesn't matter") 

SouthAmericaDEM2 <- SouthAmerica %>% 
  select(YEAR, PAIS, DEM2) %>% 
  drop_na() %>% 
  group_by(PAIS) %>% 
  mutate(total_resp_country = n()) %>% 
  filter(DEM2 == "(2) Democracy is preferable to any other form of government") %>% 
  mutate(total_dem2_country = n()) %>% 
  distinct(PAIS, .keep_all = TRUE) %>% 
  mutate(percent_good_dem2 = 100 * total_dem2_country / total_resp_country)


SouthAmericasf <- read_sf("vc965bq8111") %>%
  group_by(name) %>%
  summarise(geometry = st_combine(geometry)) %>%
  mutate(name = stringr::str_to_lower(name))
  

SouthAmericasf %>% left_join(SouthAmericaDEM2 %>% mutate(PAIS = stringr::str_to_lower(PAIS)),by = c('name' = 'PAIS')) %>% 
  ggplot() +
  geom_sf(aes(fill = percent_good_dem2))

SouthAmericaDEM2 %>% 
  select(PAIS, percent_good_dem2) %>% 
  arrange(desc(percent_good_dem2))
```

```{r}
# ECONOMIC SITUATION SOCT1 (How would you describe the country's economic situation?) (Percent of people that chose  "Good" or "Very Good" and not "fair, "bad" "very bad")


#shows NA values for this question (per country)
SouthAmerica %>% 
  select(YEAR, PAIS, SOCT1) %>% 
  group_by(PAIS) %>% 
  mutate(total_resp_country = n()) %>%
  mutate(num_na = sum(is.na(SOCT1))) %>% 
  distinct(PAIS, .keep_all = TRUE)

SouthAmericaSOCT1 <- SouthAmerica %>% 
  select(YEAR, PAIS, SOCT1) %>% 
  drop_na() %>% 
  group_by(PAIS) %>% 
  mutate(total_resp_country = n()) %>% 
  filter(SOCT1 %in% c("(2) Good", "(1) Very Good")) %>% 
  mutate(total_good_country = n()) %>% 
  distinct(PAIS, .keep_all = TRUE) %>% 
  mutate(percent_good_soct1 = 100 * total_good_country / total_resp_country)


SouthAmericasf <- read_sf("vc965bq8111") %>%
  group_by(name) %>%
  summarise(geometry = st_combine(geometry)) %>%
  mutate(name = stringr::str_to_lower(name))
  

SouthAmericasf %>% left_join(SouthAmericaSOCT1 %>% mutate(PAIS = stringr::str_to_lower(PAIS)),by = c('name' = 'PAIS')) %>% 
  ggplot() +
  geom_sf(aes(fill = percent_good_soct1))

SouthAmericaSOCT1 %>% 
  select(PAIS, percent_good_soct1) %>% 
  arrange(desc(percent_good_soct1))
```

```{r}
# scatterplots LS3 x B3:

LS3clean <- SouthAmericaLS3 %>% 
  select(PAIS, percent_good_ls3)

B3clean <- SouthAmericaB3 %>% 
  select(PAIS, percent_good_b3)

left_join(LS3clean, B3clean) %>% 
  ggplot(aes(x=percent_good_b3, y=percent_good_ls3, color = PAIS)) +
  geom_point() 
# change gkyph to name of country


# LS3 x DEM2:

DEM2clean <- SouthAmericaDEM2 %>% 
  select(PAIS, percent_good_dem2)

left_join(LS3clean, DEM2clean) %>% 
  ggplot(aes(x=percent_good_dem2, y=percent_good_ls3, color = PAIS)) +
  geom_point()


# LS3 x SOCT1

SOCT1clean <- SouthAmericaSOCT1 %>% 
  select(PAIS, percent_good_soct1)


left_join(LS3clean, SOCT1clean) %>% 
  ggplot(aes(x=percent_good_soct1, y=percent_good_ls3, color = PAIS)) +
  geom_point()
```

